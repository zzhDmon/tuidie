!function(){"use strict";function e(a,e,o,i,t,n,r,s,c){a.touchSave=function(){var e=a.name,o=a.mobile,i=a.address,t=a.regions;if(!e||e.length<2)return void a.toast("请输入姓名");if(!o||o.length<5)return void a.toast("请输入电话");if(!t||!t.length)return void a.toast("请选择地区");var n=t[t.length-1];if(!n)return void a.toast("请选择地区");if(!i||i.length<1)return void a.toast("请输入地址");{if(!a.allowSave)return;a.allowSave=!1}a.addressEditModel.save(e,o,n.id,i).then(function(e){a.allowSave=!0,e?(a.toast("保存成功"),a.goBack()):a.toast("请稍后再试")})},a.touchSetDefault=function(){a.isDefault=!a.isDefault},a.touchPickerShow=function(){a.pickerData=[],a.pickerRegions=[],a.pickerRegionName=null,a.showPicker=!0,a.addressEditModel.reloadIfNeeded().then(function(e){e?a.pickerData=a.addressEditModel.regions:(a.toast("请稍后再试"),a.touchPickerCancel())})},a.touchPickerRegion=function(e){a.pickerRegions.push(e),a.pickerRegionName=l(a.pickerRegions),e.regions&&e.regions.length?a.pickerData=e.regions:(a.regions=a.pickerRegions,a.showPicker=!1)},a.touchPickerCancel=function(){a.showPicker=!1,a.pickerData=[],a.pickerRegions=[],a.pickerRegionName=null},a.formatRegions=l,a.touchDelete=function(){var e={};e.consignee=a.addressEditModel.consignee.id,o.consignee.delete(e).then(function(e){e?(a.toast("删除成功"),a.goBack()):a.toast("删除失败")})},a.touchCancel=function(){a.goBack()},a.showPicker=!1,a.allowSave=!0,a.pickerData=[],a.pickerRegions=[],a.pickerRegionName=null,a.addressEditModel=c;var d=a.addressEditModel.consignee;function l(e){for(var o="",i=0;i<e.length;++i)o+=e[i].name,o+=" ";return o}d&&d.id&&(a.name=d.name,a.mobile=d.mobile,a.regions=d.regions,a.address=d.address,a.isDefault=d.is_default)}angular.module("app").controller("AddressEditController",e),e.$inject=["$scope","$http","API","$location","$q","$window","$state","$stateParams","AddressEditModel"]}();
!function(){"use strict";function e(e,t){e.state("address-edit",{needAuth:!0,url:"/address-edit",title:"收货地址",templateUrl:"modules/address-edit/address-edit.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(e,n,i,t,o,r,s,d){var a={isLoaded:!1,isLoading:!1,consignee:null,regions:null,save:function(e,n,i,t){if(!d.getToken())return;{if(this.consignee&&this.consignee.id){var o=this;return r.consignee.update({consignee:this.consignee.id,name:e,mobile:n,tel:n,zip_code:"",region:i,address:t}).then(function(e){return!!(o.consignee=e)})}var o=this;return r.consignee.add({name:e,mobile:n,tel:n,zip_code:"",region:i,address:t}).then(function(e){return!!(o.consignee=e)})}},clear:function(){this.consignee=null}};return a.reload=c,a.reload=c,a.reloadIfNeeded=function(){if(!d.getToken())return;{if(this.isLoaded){var e=n.defer();return i(function(){e.resolve(!0)},1),e.promise}return this.reload()}},a;function c(){if(d.getToken()&&!this.isLoading){this.isLoading=!0;var n=this;return r.region.list({}).then(function(e){return e&&e.length?(n.isLoading=!1,n.isLoaded=!0,n.regions=e):$scope.toast("没有可选地址"),!!e})}}}angular.module("app").factory("AddressEditModel",e),e.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}();
!function(){"use strict";function o(a,o,e,t,n,r,l,i,c,p,d){a.paymentModel=i;var s=l.order;if(s){e.$on("onPaySuccess",function(o,a){n.go("payment-success",{order:s})}),e.$on("onPayFailed",function(o,a){n.go("payment-failed",{order:s,reason:"支付宝支付失败"})});var y=encodeURIComponent(t.location.protocol+"//"+t.location.host+t.location.pathname),m={order:s,code:"alipay.wap",referer:y};c.payment.pay(m).then(function(o){return o.data.alipay&&o.data.alipay.html&&(a.alipay_html=p.trustAsHtml(o.data.alipay.html)),!0})}else n.go("payment-failed",{order:s,reason:"参数错误"})}angular.module("app").controller("AliPayWapController",o),o.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","PaymentModel","API","$sce","ConfigModel"]}();
!function(){"use strict";function a(a,l){a.state("alipay-wap",{needAuth:!0,url:"/alipay-wap?order",title:"微信支付",controller:"AliPayWapController",templateUrl:"modules/alipay-wap/alipay-wap.html"})}angular.module("app").config(a),a.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(o,e,d,s,t,n,l,i,r){o.selectedId=d.address,o.addressSelectModel=r,o.touchCreate=function(){o.addressEditModel.clear(),o.addressEditModel.consignee=null,t.go("address-edit",{})},o.touchModify=function(e){o.addressEditModel.clear(),o.addressEditModel.consignee=e,t.go("address-edit",{})},o.touchConsignee=function(e){s.$emit("consigneeChanged",e),o.goBack()},o.touchDefaultAddress=function(t){n.consignee.setDefault({consignee:t.id}).then(function(e){if(e)for(var d=0;d<o.myAddressModel.consignees.length;d++){var s=o.myAddressModel.consignees[d];s.id==t.id?s.is_default=!0:s.is_default=!1}else o.toast("设置失败")})},o.isDefaultAddress=function(e){return!!e.is_default},o.addressEditModel=i,o.addressSelectModel.clear(),o.addressSelectModel.reload()}angular.module("app").controller("AddressSelectController",e),e.$inject=["$scope","$http","$stateParams","$rootScope","$state","API","ENUM","AddressEditModel","AddressSelectModel"]}();
!function(){"use strict";function e(e,t){e.state("address-select",{needAuth:!0,url:"/address-select?address",title:"选择地址",templateUrl:"modules/address-select/address-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function n(n,e,i,o,t,s,c){var a={isLoading:!1,isLoaded:!1,consignees:null,clear:function(){this.consignees=null},reload:function(){this.isLoading=!1,this.isLoaded=!1;var e=this;return s.consignee.list({}).then(function(n){e.consignees=n,e.isLoading=!1,e.isLoaded=!0})}};return a}angular.module("app").factory("AddressSelectModel",n),n.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM"]}();
!function(){"use strict";function e(t,a,e,i,r){t.touchArticle=function(e){e.url?r.location.href=e.url:a.go("article",{id:e.id,title:e.title})},t.articles=[];var l=e.id;e.title?t.title=e.title:t.title="使用帮助",t.loading=!1,t.loaded=!1,t.more=!0;var o=1;function n(){if(!t.loading){var e={};o=1,e=l?{page:o,per_page:10,id:l}:{page:o,per_page:10,id:0},i.article.list(e).then(function(e){e&&(t.articles=e.articles,t.loading=!1,t.loaded=!0,t.more=parseInt(e.paged.more))})}}t.reload=n,t.loadMore=function(){if(t.loading)return;var e={};e=l?{page:o,per_page:10,id:l}:{page:o,per_page:10,id:0};i.article.list(e).then(function(e){e&&(t.articles=t.articles.concat(e.articles),t.loading=!1,t.loaded=!0,t.more=parseInt(e.paged.more))})},n()}angular.module("app").controller("ArticleController",e),e.$inject=["$scope","$state","$stateParams","API","$window"]}();
!function(){"use strict";function t(t,e){t.state("article",{needAuth:!1,url:"/article?id&title",title:"使用帮助",templateUrl:"modules/article/article.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function a(a,e,t,l,n,T,c,o,r,u){a.TAB_ALL=0,a.TAB_INCOME=1,a.TAB_EXPENDITURE=2,a.currentTab=a.TAB_ALL,a.myBalanceModel=u,"all"==c.tab?(a.currentTab=a.TAB_ALL,a.myBalanceModel.status=null):"income"==c.tab?(a.currentTab=a.TAB_INCOME,a.myBalanceModel.status=r.BALANCE_STATUS.IN):"expenditure"==c.tab?(a.currentTab=a.TAB_EXPENDITURE,a.myBalanceModel.status=r.BALANCE_STATUS.OUT):(a.currentTab=a.TAB_ALL,a.myBalanceModel.status=null),a.touchTabAll=function(){a.currentTab!=a.TAB_ALL&&(a.currentTab=a.TAB_ALL,a.myBalanceModel.status=null,a.myBalanceModel.reload())},a.touchTabIncome=function(){a.currentTab!=a.TAB_INCOME&&(a.currentTab=a.TAB_INCOME,a.myBalanceModel.status=r.BALANCE_STATUS.IN,a.myBalanceModel.reload())},a.touchTabExpenditure=function(){a.currentTab!=a.TAB_EXPENDITURE&&(a.currentTab=a.TAB_EXPENDITURE,a.myBalanceModel.status=r.BALANCE_STATUS.OUT,a.myBalanceModel.reload())},a.myBalanceModel.reload()}angular.module("app").controller("BalanceHistoryController",a),a.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","BalanceModel"]}();
!function(){"use strict";function t(t,e){t.state("balance-history",{needAuth:!0,url:"/balance-history",title:"资金明细",templateUrl:"modules/balance-history/balance-history.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function n(o,n,e,l,t,u,r,c,i,a,s){o.cancellingOrder=null,o.showDialog=!1,o.bonus_amount=0,o.total_bonus=0,o.myBonusModel=a,o.touchDialogCancel=function(){o.cancellingOrder=null,o.showDialog=!1},o.touchDialogConfirm=function(){c.order.cancel({order:o.cancellingOrder.id,reason:1}).then(function(n){o.myOrderModel.reload(),o.cancellingOrder=null,o.showDialog=!1})},o.touchRecommend=function(){u.go("my-recommend",{})},o.touchMyBalance=function(){u.go("my-balance",{})},o.touchRules=function(){u.go("bonus-rule",{})},o.touchCancel=function(n){o.cancellingOrder=n,o.showDialog=!0},o.getBonusStatus=function(n){{if(n==i.BONUS_STATUS.WAIT)return"审核中";if(n==i.BONUS_STATUS.FINISH)return"已分成";if(n==i.BONUS_STATUS.CANCEL)return"已取消";if(n==i.BONUS_STATUS.REVOKE)return"已撤销"}return""},o.getBonusType=function(n){return n==i.BONUS_TYPE.SIGNUP?"注册分成":"订单分成"},o.myBonusModel.reload()}angular.module("app").controller("BonusController",n),n.$inject=["$scope","$rootScope","$window","$timeout","$location","$state","$stateParams","API","ENUM","BonusModel","ConfigModel"]}();
!function(){"use strict";function t(t,e){t.state("bonus",{needAuth:!0,url:"/bonus",title:"我的订单",templateUrl:"modules/bonus/bonus.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,s,n,e,i,o,u,a){var r={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,fetch:function(t,s){if(!o.getToken())return;this.isLoading=!0;var n={page:t,per_page:s};null!=this.status&&(n.status=this.status);var e=this;u.bonus.list(n).then(function(t){return e.bonuses=e.bonuses?e.bonuses.concat(t):t,e.isEmpty=!e.bonuses||!e.bonuses.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=!!(t&&t.length<s)&&!e.isEmpty,!0})},getInfo:function(){if(!o.getToken())return;var s=this;u.bonus.get({}).then(function(t){return s.bonus_info=t,!0})},reload:function(){if(!o.getToken())return;if(this.isLoading)return;return this.bonuses=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,10),this.getInfo()},loadMore:function(){if(!o.getToken())return;if(this.isLoading)return;if(this.isLastPage)return;this.bonuses&&this.bonuses.length?this.fetch(this.bonuses.length/10+1,10):this.fetch(1,10)},bonuses:[]};return r}angular.module("app").factory("BonusModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function o(e,o,t,n,s,u,l,c,r,d){e.bonusModel=c,e.bonusModel.bonus_info&&(e.rule_desc=d.trustAsHtml(e.bonusModel.bonus_info.rule_desc)),r.bonus.get().then(function(o){e.rule_desc=d.trustAsHtml(o.rule_desc)})}angular.module("app").controller("BonusRuleController",o),o.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","BonusModel","API","$sce"]}();
!function(){"use strict";function e(e,u){e.state("bonus-rule",{needAuth:!1,url:"/bonus-rule",title:"分成规则",controller:"BonusRuleController",templateUrl:"modules/bonus-rule/bonus-rule.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(i,e,o,t,n,l){function r(){for(var e=0,o=0,t=i.selectedGoods,n=0;n<t.length;++n)e+=Number(t[n].amount),o+=t[n].amount*t[n].price;i.selectedAmount=e,i.selectedPrice=o}i.showDialog=!1,i.deletingGoods=null,i.touchDelete=function(e){i.deletingGoods=e,i.showDialog=!0},i.touchDialogCancel=function(){i.showDialog=!1,i.deletingGoods=null},i.touchDialogConfirm=function(){if(!i.deletingGoods)return;i.cartModel.delete(i.deletingGoods.id).then(function(e){if(e){for(var o=i.selectedGoods,t=0;t<o.length;++t){var n=o[t];if(n.id==i.deletingGoods.id){o.splice(t,1);break}}i.toast("删除成功"),i.showDialog=!1,i.deletingGoods=null,r()}})},i.touchProduct=function(e){t.go("product",{product:e.id})},i.touchSubmit=function(){if(!i.selectedGoods||!i.selectedGoods.length)return void i.toast("请先选择商品");n.clear(),n.goods=i.selectedGoods,t.go("confirm-cart",{})},i.touchAmountSub=function(e){if(e.amount<=1)return;i.cartModel.update(e.id,Number(e.amount)-1).then(function(e){r()})},i.touchAmountAdd=function(e){i.cartModel.update(e.id,Number(e.amount)+1).then(function(e){r()})},i.touchSelect=function(e){for(var o=i.selectedGoods,t=-1,n=0;n<o.length;++n){var l=o[n];if(l.id==e.id){t=n;break}}-1==t?o.push(e):o.splice(t,1);r()},i.touchSelectAll=function(){var e=i.cartModel.groups,o=[],t=!i.isSelectedAll;if(t)for(var n=0;n<e.length;++n)for(var l=e[n],d=0;d<l.goods.length;++d){var c=l.goods[d];o.push(c)}i.selectedGoods=o,i.isSelectedAll=t,r()},i.isSelected=function(e){for(var o=i.selectedGoods,t=0;t<o.length;++t)if(e.id==o[t].id)return!0;return!1},i.isSelectedAll=!1,i.selectedGoods=[],i.selectedAmount=0,i.selectedPrice=0,i.cartModel=l,i.cartModel.reload()}angular.module("app").controller("CartController",e),e.$inject=["$scope","$http","$location","$state","ConfirmCartService","CartModel"]}();
!function(){"use strict";function t(t,e){t.state("cart",{needAuth:!0,url:"/cart",title:"购物车",templateUrl:"modules/cart/cart.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,o,r,n,e,u,g,i){var a={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,total:0,subtotal:{},groups:null,count:function(){var t=0;if(this.groups)for(var o=this.groups,r=0;r<o.length;++r)for(var n=o[r],e=0;e<n.goods.length;++e)t+=Number(n.goods[e].amount);this.total=t},add:function(t,o,r){if(!u.getToken())return;var n=this;return g.cart.add({product:t,property:JSON.stringify(o),amount:r}).then(function(t){return t&&n.reload(),t})},delete:function(i){if(!u.getToken())return;var a=this;return g.cart.delete({good:i}).then(function(t){if(t){for(var o=a.groups,r=0;r<o.length;++r)for(var n=o[r],e=0;e<n.goods.length;++e){var u=n.goods[e];if(u.id==i){n.goods.splice(e,1);break}}a.isEmpty=!a.groups||!a.groups.length,a.count()}return t})},update:function(i,a){if(!u.getToken())return;var s=this;return g.cart.update({good:i,amount:a}).then(function(t){if(t){for(var o=s.groups,r=0;r<o.length;++r)for(var n=o[r],e=0;e<n.goods.length;++e){var u=n.goods[e];if(u.id==i){u.amount=a;break}}s.isEmpty=!s.groups||!s.groups.length,s.count()}return t})},reload:function(){if(!u.getToken())return this.total=0,void(a.total=0);var o=this;return g.cart.get({}).then(function(t){return t&&(o.groups=t,o.isEmpty=!o.groups||!o.groups.length,o.isLoaded=!0,o.isLoading=!1,o.count()),g.order.subtotal().then(function(t){o.subtotal=t}),!!t})},reloadIfNeeded:function(){this.reload()}};return a}angular.module("app").factory("CartModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function t(t,e){t.state("cart-select",{needAuth:!0,url:"/cart-select",title:"购物车",templateUrl:"modules/cart-select/cart-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(l,t,e,c,o,a,i,s,n,d){l.selectedId=a.cashgift||null,l.totalPrice=a.total||0,l.cashgiftSelectModel=d,l.cashgiftSelectModel.clear(),l.cashgiftSelectModel.totalPrice=l.totalPrice,l.touchClear=function(){l.selectedId=null},l.touchCashgift=function(t){l.selectedId=t.id},l.touchConfirm=function(){var t=null,e=l.cashgiftSelectModel.cashgifts;for(var c in e)if(e[c].id==l.selectedId){t=e[c];break}o.$emit("cashgiftChanged",t),l.goBack()},l.cashgiftSelectModel.reload()}angular.module("app").controller("CashgiftSelectController",t),t.$inject=["$scope","$http","$location","$timeout","$rootScope","$stateParams","$state","API","ENUM","CashgiftSelectModel"]}();
!function(){"use strict";function t(t,e){t.state("cashgift-select",{needAuth:!0,url:"/cashgift-select?cashgift&total",title:"选择红包",templateUrl:"modules/cashgift-select/cashgift-select.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,i,s,e,a,h,n,c){var o={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,cashgifts:null,totalPrice:0,clear:function(){this.cashgifts=null,this.totalPrice=0},fetch:function(t,i){if(!c.getToken())return;this.isLoading=!0;var s=this;h.cashgift.available({total_price:this.totalPrice,page:t,per_page:i}).then(function(t){s.cashgifts=s.cashgifts?s.cashgifts.concat(t):t,s.isEmpty=!s.cashgifts||!s.cashgifts.length,s.isLoaded=!0,s.isLoading=!1,s.isLastPage=!!(t&&t.length<i)&&!s.isEmpty})},reload:function(){if(!c.getToken())return;if(this.isLoading)return;this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.fetch(1,10)},loadMore:function(){if(!c.getToken())return;if(this.isLoading)return;if(this.isLastPage)return;this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/10+1,10):this.fetch(1,10)}};return o}angular.module("app").factory("CashgiftSelectModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","API","ENUM","AppAuthenticationService"]}();
!function(){"use strict";function e(l,e,t,a,o,r,n){var c=1e3;l.categories=[],l.selectedSide=null,l.touchSearch=function(){a.go("search",{})},l.touchSide=function(e){l.selectedSide=e,l.subCategories=e.categories},l.touchMain=function(e){if(e)a.go("search-result",{sortKey:r.SORT_KEY.DEFAULT,sortValue:r.SORT_VALUE.DEFAULT,keyword:null,category:e.id,title:e.name,navTitle:e.name,navStyle:"default"});else{var t=l.selectedSide;a.go("search-result",{sortKey:r.SORT_KEY.DEFAULT,sortValue:r.SORT_VALUE.DEFAULT,keyword:null,category:t.id,navTitle:t.name,title:t.name,navStyle:"default"})}},l.cartModel=n,o.category.list({page:1,per_page:c}).then(function(e){e&&e.length?(l.categories=e,l.selectedSide=e[0],l.subCategories=e[0].categories):(l.categories=null,l.selectedSide=null,l.subCategories=null)})}angular.module("app").controller("CategoryController",e),e.$inject=["$scope","$http","$location","$state","API","ENUM","CartModel"]}();
!function(){"use strict";function t(t,e){t.state("category",{needAuth:!1,url:"/category",title:"商品分类",templateUrl:"modules/category/category.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(r,o,s,a,t,d,n){r.oldPassword="",r.newPassword="",r.touchChangePassword=function(){var o=r.oldPassword,s=r.newPassword,a=r.newPassword2;if(s!=a)return void r.toast("两次密码输入不一致");d.user.passwordUpdate({old_password:o,password:s}).then(function(o){0==o.data.error_code?(r.toast("密码修改成功"),r.goBack()):r.toast(o.data.error_desc)})}}angular.module("app").controller("ChangePasswordController",o),o.$inject=["$scope","$http","$window","$location","$state","API","ENUM"]}();
!function(){"use strict";function e(e,t){e.state("change-password",{needAuth:!0,url:"/change-password",title:"修改密码",templateUrl:"modules/change-password/change-password.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(o,t,n,e,r,a,c,i,u){var s=10,A=c.product;function E(t,n){var e=u.REVIEW_GRADE.ALL;o.currentTab==o.TAB_ALL?e=u.REVIEW_GRADE.ALL:o.currentTab==o.TAB_BAD?e=u.REVIEW_GRADE.BAD:o.currentTab==o.TAB_MEDIUM?e=u.REVIEW_GRADE.MEDIUM:o.currentTab==o.TAB_GOOD&&(e=u.REVIEW_GRADE.GOOD),o.isLoading=!0,i.review.productList({product:A,grade:e,page:t,per_page:n}).then(function(t){o.comments=o.comments?o.comments.concat(t):t,o.isEmpty=!o.comments||!o.comments.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(t&&t.length<n)&&!o.isEmpty})}function m(){o.isLoading||(o.comments=null,o.isEmpty=!1,o.isLoaded=!1,E(1,s))}o.TAB_ALL=0,o.TAB_BAD=1,o.TAB_MEDIUM=2,o.TAB_GOOD=3,o.currentPage=0,o.currentTab=o.TAB_ALL,o.comments=null,o.touchTabAll=function(){o.currentTab=o.TAB_ALL,m()},o.touchTabBad=function(){o.currentTab=o.TAB_BAD,m()},o.touchTabMedium=function(){o.currentTab=o.TAB_MEDIUM,m()},o.touchTabGood=function(){o.currentTab=o.TAB_GOOD,m()},o.loadMore=function(){if(o.isLoading)return;if(o.isLastPage)return;o.comments&&o.comments.length?E(o.comments.length/s+1,s):E(1,s)},o.formatGrade=function(t){{if(u.REVIEW_GRADE.BAD==t)return"差评";if(u.REVIEW_GRADE.MEDIUM==t)return"中评";if(u.REVIEW_GRADE.GOOD==t)return"好评"}return"中评"},o.isEmpty=!1,o.isLoaded=!1,o.isLoading=!1,o.isLastPage=!1,m()}angular.module("app").controller("CommentController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}();
!function(){"use strict";function t(t,e){t.state("comment",{needAuth:!1,url:"/comment/?product",title:"商品评价",templateUrl:"modules/comment/comment.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(d,e,o,f,n,i,t,m,c,h,v,s,x){function r(){var e=d.goods,o=d.consignee,n=d.express,i=d.coupon,t=d.cashgift,c=d.input.score;if(e&&e.length){if(o){for(var s=[],r=0;r<e.length;++r)s.push({goods_id:e[r].product.id,property:e[r].attrs.split(","),num:e[r].amount});var u={};u.order_product=JSON.stringify(s),o&&(u.consignee=o.id),n&&(u.shipping=n.id),t&&(u.cashgift=t.id),i&&(u.coupon=i.id),c&&(u.score=c),m.order.price(u).then(function(e){for(var o in d.priceInfo=e,d.all_discount=e.discount_price,e.promos)d.all_discount+=parseFloat(e.promos[o].price)})}}else d.toast("商品信息不存在")}h.goods&&h.goods.length?(d.touchAddress=function(){f.go("address-select",{address:d.consignee?d.consignee.id:null})},d.touchExpress=function(){if(!d.consignee)return void d.toast("请选择地址");for(var e=d.goods,o=[],n=[],i=[],t=0;t<e.length;++t)o.push(e[t].product.id),n.push(e[t].amount),i.push(e[t].attrs.split(","));v.clear(),v.expressId=d.express?d.express.id:null,v.goodsIds=o,v.goodsNumbers=n,v.region=d.consignee.id,v.propertys=i,f.go("express-select",{})},d.touchInvoice=function(){s.clear(),s.type=d.invoiceType?d.invoiceType:null,s.title=d.invoiceTitle,s.content=d.invoiceContent?d.invoiceContent:null,f.go("invoice-select",{})},d.touchCashgift=function(){var e=d.goods,o=(d.consignee,d.express,d.cashgift),n=0;for(var i in e)n+=e[i].price;f.go("cashgift-select",{cashgift:o?o.id:null,total:n})},d.touchSubmit=function(){var e=d.goods,o=d.consignee,n=d.express,i=d.coupon,t=d.cashgift,c=d.input.score,s=d.input.comment,r=d.invoiceType,u=d.invoiceTitle,l=d.invoiceContent,p=[];if(!e||!e.length)return void d.toast("商品信息不存在");for(var a=0;a<e.length;++a)p.push(e[a].id);if(!p||!p.length)return void d.toast("商品信息不存在");if(!o)return void d.toast("请填写地址");if(!n)return void d.toast("请选择快递");var g={shop:1,consignee:o?o.id:null,cart_good_id:p?JSON.stringify(p):null,shipping:n?n.id:null,invoice_type:r?r.name:null,invoice_title:u,invoice_content:l?l.name:null,coupon:i?i.id:null,cashgift:t?t.id:null,score:c,comment:s};m.cart.checkout(g).then(function(e){e&&(h.clear(),v.clear(),x.clear(),x.order=e,f.go("payment",{order:e.id}))})},d.refreshScore=function(){d.timer&&(i.cancel(d.timer),d.timer=null);d.timer=i(function(){var e=d.scoreInfo.score>d.maxUseScore?d.maxUseScore:d.scoreInfo.score;d.input.score>e&&(d.input.score=e),d.input.score<0&&(d.input.score=0),h.input.score=d.input.score,r(),d.timer=null},200)},d.refreshComment=function(){h.input.comment=d.input.comment},d.goods=h.goods,d.consignee=h.consignee,d.invoiceType=h.invoiceType,d.invoiceTitle=h.invoiceTitle,d.invoiceContent=h.invoiceContent,d.cashgift=h.cashgift,d.express=h.express,d.coupon=h.coupon,d.all_discount=0,d.input={score:0,comment:""},d.input.score=h.input.score,0==d.input.score&&(d.input.score=""),d.input.comment=h.input.comment,d.scoreInfo=null,d.priceInfo=null,d.canPurchase=!!(d.goods&&d.goods.length&&d.consignee&&d.express),d.maxUseScore=0,d.formatPromo=function(e){return"score"==e?"积分":"cashgift"==e?"红包":"preferential"==e?"优惠金额":"goods_reduction"==e?"商品减免":"order_reduction"==e?"订单减免":"coupon_reduction"==e?"优惠券减免":"其他优惠"},r(),function(){for(var e=d.maxUseScore=0;e<d.goods.length;++e)d.maxUseScore+=d.goods[e].product.score*d.goods[e].amount;m.score.get({}).then(function(e){d.scoreInfo=e,d.refreshScore()})}(),m.consignee.list({}).then(function(e){if(e&&(d.consigneeList=e,!d.consignee))for(var o in d.consigneeList)d.consigneeList[o].is_default&&(d.consignee=d.consigneeList[o],n.$emit("consigneeChanged",d.consignee))})):i(function(){n.goHome()},1)}angular.module("app").controller("ConfirmCartController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","ConfirmCartService","ExpressSelectService","InvoiceSelectService","PaymentModel"]}();
!function(){"use strict";function r(r,t){r.state("confirm-cart",{needAuth:!0,url:"/confirm-cart",templateUrl:"modules/confirm-cart/confirm-cart.html"})}angular.module("app").config(r),r.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function n(n,e,i,t,o,c){var l={goods:[],invoiceType:null,invoiceTitle:null,invoiceContent:null,express:null,cashgift:null,consignee:null,coupon:null,clear:function(){this.goods=[],this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}},input:{score:0,comment:""}};return t.$on("consigneeChanged",function(n,e){l.consignee=e}),t.$on("expressChanged",function(n,e){l.express=e}),t.$on("invoiceChanged",function(n,e){l.invoiceTitle=e.title,l.invoiceType=e.type,l.invoiceContent=e.content}),t.$on("cashgiftChanged",function(n,e){l.cashgift=e}),l}angular.module("app").factory("ConfirmCartService",n),n.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}();
!function(){"use strict";function o(o,e,r,t,n){var i=n.order;o.isDelivery=!0,o.reason=n.reason,o.touchDetail=function(){t.go("order-detail",{order:i})},o.touchComment=function(){t.go("order-review",{order:i})}}angular.module("app").controller("ConfirmDeliveryController",o),o.$inject=["$scope","$http","$location","$state","$stateParams"]}();
!function(){"use strict";function e(e,r){e.state("confirm-delivery",{needAuth:!0,url:"/confirm-delivery?order",title:"交易成功",templateUrl:"modules/confirm-delivery/confirm-delivery.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(s,p,n,e,c,r,u,o,a){if(s.touchAddress=function(){p.go("address-select",{address:s.consignee?s.consignee.id:null})},s.touchExpress=function(){if(!s.consignee)return void s.toast("请选择地址");var e=[],o=[],n=[];for(var t in s.selectedGoods){var i=s.selectedGoods[t];e.push(i.product.id),o.push(i.amount);var c=i.attrs[0],r=[];c?r.push(c.toString()):r.push(""),n.push(r)}u.clear(),u.expressId=s.express?s.express.id:null,u.goodsIds=e,u.goodsNumbers=o,u.region=s.consignee.id,u.propertys=n,p.go("express-select",{})},s.touchInvoice=function(){o.clear(),o.type=s.invoiceType?s.invoiceType:null,o.title=s.invoiceTitle,o.content=s.invoiceContent?s.invoiceContent:null,p.go("invoice-select",{})},s.touchCashgift=function(){p.go("cashgift-select",{cashgift:s.cashgift?s.cashgift.id:null,total:s.priceInfo?s.priceInfo.product_price:0})},s.touchSubmit=function(){var e=s.consignee,o=s.express;if(!e)return void s.toast("请填写地址");if(!o)return void s.toast("请选择快递");var n={};for(var t in s.selectedGoods){var i=s.selectedGoods[t];n.product=i.product.id,n.property=JSON.stringify(i.attrs),n.amount=i.amount}s.consignee&&(n.consignee=s.consignee.id);s.express&&(n.shipping=s.express.id);s.cashgift&&(n.cashgift=s.cashgift.id);s.input.score&&(n.score=s.input.score);s.invoiceContent&&(n.invoice_content=s.invoiceContent.name);s.invoiceType&&(n.invoice_type=s.invoiceType.name);s.invoiceTitle&&(n.invoice_title=s.invoiceTitle);s.input.comment&&(n.comment=s.input.comment);c.product.purchase(n).then(function(e){e&&(r.clear(),u.clear(),a.clear(),a.order=e,p.go("payment",{order:e.id}))})},s.refreshScore=function(){var e=s.scoreInfo.score>s.maxUseScore?s.maxUseScore:s.scoreInfo.score;s.input.score>e&&(s.input.score=e);s.input.score<0&&(s.input.score=0);r.input.score=s.input.score,_()},s.refreshComment=function(){r.input.comment=s.input.comment},s.consigneeList=[],s.consignee=r.consignee,s.invoiceType=r.invoiceType,s.invoiceTitle=r.invoiceTitle,s.invoiceContent=r.invoiceContent,s.cashgift=r.cashgift,s.express=r.express,s.coupon=r.coupon,s.all_discount=0,s.input={score:0,comment:""},s.input.score=r.input.score,s.input.comment=r.input.comment,0==s.input.score&&(s.input.score=""),s.rule="",s.scoreInfo=null,s.priceInfo={},s.canPurchase=function(){return!!(s.selectedGoods&&s.selectedGoods.length&&s.consignee&&s.express)},s.formatPromo=function(e){return"score"==e?"积分":"cashgift"==e?"红包":"preferential"==e?"优惠金额":"goods_reduction"==e?"商品减免":"order_reduction"==e?"订单减免":"coupon_reduction"==e?"优惠券减免":"其他优惠"},s.maxUseScore=0,s.selectedGoods=[],r.product){var t={};t.product=r.product;var i=r.attrs;t.property="",t.attrs=[];for(var d=parseFloat(t.product.current_price),l=i.length,f=0;f<l;f++)for(var g=t.product.properties.length,v=0;v<g;v++)for(var m=t.product.properties[v],h=m.attrs.length,x=0;x<h;x++){var y=m.attrs[x];parseInt(y.id)==i[f]&&(0<t.property.length?t.property+=","+y.attr_name:t.property=y.attr_name,t.attrs.push(y.id),d+=parseFloat(y.attr_price))}t.amount=r.amount,t.price=d,s.selectedGoods.push(t),c.consignee.list({}).then(function(e){if(e&&(s.consigneeList=e,!s.consignee)){for(var o in s.consigneeList)s.consigneeList[o].is_default&&(s.consignee=s.consigneeList[o],n.$emit("consigneeChanged",s.consignee));_()}}),function(){for(var e=s.maxUseScore=0;e<s.selectedGoods.length;++e)s.maxUseScore+=s.selectedGoods[e].product.score*s.selectedGoods[e].amount;c.score.get({}).then(function(e){s.scoreInfo=e})}(),_()}function _(){if(s.consignee){var e=[];for(var o in s.selectedGoods){var n=s.selectedGoods[o],t={goods_id:n.product.id,property:n.attrs,num:n.amount,total_amount:n.amount};e.push(t)}var i={};i.order_product=JSON.stringify(e),s.consignee&&(i.consignee=s.consignee.id),s.express&&(i.shipping=s.express.id),s.cashgift&&(i.cashgift=s.cashgift.id),s.coupon&&(i.coupon=s.coupon.id),s.input.score&&(i.score=s.input.score),c.order.price(i).then(function(e){if(e)for(var o in s.priceInfo=e,s.all_discount=e.discount_price,e.promos)s.all_discount+=parseFloat(e.promos[o].price)})}}}angular.module("app").controller("ConfirmController",e),e.$inject=["$scope","$state","$rootScope","$stateParams","API","ConfirmProductService","ExpressSelectService","InvoiceSelectService","PaymentModel"]}();
!function(){"use strict";function t(t,r){t.state("confirm-product",{needAuth:!0,url:"/confirm-product",title:"确认订单",templateUrl:"modules/confirm-product/confirm-product.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function n(n,e,i,t,o,l){var c={product:null,properties:null,amount:null,invoiceType:null,invoiceTitle:null,invoiceContent:null,shippingVendor:null,cashgift:null,consignee:null,coupon:null,express:null,clear:function(){this.product=null,this.properties=null,this.amount=null,this.invoiceType=null,this.invoiceTitle=null,this.invoiceContent=null,this.express=null,this.cashgift=null,this.consignee=null,this.coupon=null,this.input={score:0,comment:""}},input:{score:0,comment:""}};return l.$on("consigneeChanged",function(n,e){c.consignee=e}),l.$on("expressChanged",function(n,e){c.express=e}),l.$on("invoiceChanged",function(n,e){c.invoiceTitle=e.title,c.invoiceType=e.type,c.invoiceContent=e.content}),l.$on("cashgiftChanged",function(n,e){c.cashgift=e}),c}angular.module("app").factory("ConfirmProductService",n),n.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}();
!function(){"use strict";function i(a,i,t,s,e,n,r){var o=10;function l(i,t){a.isLoading=!0,r.article.list({id:13,page:i,per_page:t}).then(function(i){a.diaryList=a.diaryList?a.diaryList.concat(i.articles):i.articles,a.isEmpty=!a.diaryList||!a.diaryList.length,a.isLoaded=!0,a.isLoading=!1,a.isLastPage=!!(i.articles&&i.articles.length<o)&&!a.isEmpty})}a.isEmpty=!1,a.isLoaded=!1,a.isLoading=!1,a.isLastPage=!1,a.loadMore=function(){if(a.isLoading)return;if(a.isLastPage)return;if(a.diaryList&&a.diaryList.length){if(a.diaryList.length%2)return;l(a.diaryList.length/o+1,o)}else l(1,o)},a.isLoading||(a.diaryList=null,a.isEmpty=!1,a.isLoaded=!1,l(1,o)),a.articleDetail=function(i){t.location.href=i.link}}angular.module("app").controller("MDiaryController",i),i.$inject=["$scope","$http","$window","$location","$state","$rootScope","API"]}();
!function(){"use strict";function t(t,e){t.state("diary",{needAuth:!1,url:"/diary",title:"蜕蝶日记",templateUrl:"modules/diary/diary.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(o,t,i,e,n,c,r){r.article.list({id:13,page:1,per_page:10}).then(function(t){o.diaryList=t.articles}),o.loadMore=function(){},o.articleDetail=function(t){i.location.href=t.link}}t.$inject=["$scope","$http","$window","$location","$state","$rootScope","API"],angular.module("app").controller("DiaryController",t),MDiaryController.$inject=["$scope","$http","$window","$location","$state","$rootScope","API"]}();
!function(){"use strict";function t(t,e){t.state("diary",{needAuth:!0,url:"/diary",title:"蜕蝶日记",templateUrl:"modules/diary/diary.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(u,o,e,s,r,t,c,n,d){u.selectedId=d.expressId||null,u.goodsIds=d.goodsIds||[],u.propertys=d.propertys||[],u.goodsNumbers=d.goodsNumbers||[],u.region=d.region||null,u.vendors=[],u.touchVendor=function(o){s.$emit("expressChanged",o),u.goBack()},function(){for(var o=u.goodsIds,e=u.goodsNumbers,s=u.propertys,r=[],t=0;t<o.length&&t<e.length;++t)r.push({goods_id:o[t],property:s[t],num:e[t]});var n=[];for(var d in u.selectedGoods){var p=u.selectedGoods[d],i={goods_id:p.product.id,num:p.amount};n.push(i)}c.shipping.vendorList({shop:1,products:JSON.stringify(r),address:u.region}).then(function(o){u.vendors=o})}()}angular.module("app").controller("ExpressSelectController",o),o.$inject=["$scope","$http","$window","$rootScope","$state","$stateParams","API","ENUM","ExpressSelectService"]}();
!function(){"use strict";function e(e,t){e.state("express-select",{needAuth:!0,url:"/express-select",title:"配送方式",templateUrl:"modules/express-select/express-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function l(l,e,s,o,t,n){var r={expressId:null,goodsIds:null,goodsNumbers:null,region:null,clear:function(){this.expressId=null,this.goodsIds=null,this.goodsNumbers=null,this.region=null,this.propertys=null},propertys:null};return r}angular.module("app").factory("ExpressSelectService",l),l.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}();
!function(){"use strict";function e(n,e,t,a,o,r,i,c,s,l){n.TAB_MOBILE=0,n.TAB_EMAIL=1,n.currentTab=n.TAB_MOBILE,"mobile"==r.tab?n.currentTab=n.TAB_MOBILE:"email"==r.tab?n.currentTab=n.TAB_EMAIL:n.currentTab=n.TAB_MOBILE,n.touchTabMobile=function(){n.currentTab!=n.TAB_MOBILE&&(n.currentTab=n.TAB_MOBILE,n.forgetMobile={show:!0})},n.touchTabEmail=function(){n.currentTab!=n.TAB_EMAIL&&(n.currentTab=n.TAB_EMAIL,n.forgetMobile={show:!1})},n.toucheMobileCode=function(){if(!n.paraevent)return;var e=n.state.mobile;if(!e||e.length<1)return void n.toast("请输入手机号码");var t={};t.mobile=e,t.code="86",i.auth.mobile.send(t).then(function(e){var t,a;e.data&&c.ERROR_CODE.OK==e.data.error_code?(t=60,a=void 0,a=l(function(){t<=0?(l.cancel(a),a=void 0,t=60,n.paracont="重发验证码",n.paraclass="mobile-code",n.paraevent=!0):(n.paracont=t+"s",n.paraclass="not-mobile-code",n.paraevent=!1,t--)},1e3,100)):n.toast(e.data.error_desc)})},n.touchforgetMobile=function(){var e=n.state.mobile,t=n.state.mobile_code,a=n.state.mobile_password,o=n.state.mobile_password2;if(!e||e.length<1)return void n.toast("请输入手机号码");if(!t||6!=t.length)return void n.toast("请输入正确的手机验证码");if(!a||a.length<6)return void n.toast("请输入正确的密码");if(a!=o)return n.toast("请输入正确的密码"),void(n.password2="");var r={};r.mobile=e,r.code=t,r.password=a,s.getReferences()&&(r.invite_code=parseInt(s.getReferences()));i.auth.mobile.reset(r).then(function(e){e.data&&c.ERROR_CODE.OK==e.data.error_code?(n.toast("找回密码成功"),n.goBack()):n.toast(e.data.error_desc)})},n.touchBackLogin=function(){n.goBack()},n.forgetMobile={show:!0},n.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},n.paracont="获取验证码",n.paraclass="mobile-code",n.paraevent=!0,n.success=!1,n.email="",n.input={email:""},n.touchSendMail=function(){var a=n.input.email;if(!a||a.length<4)return void n.toast("请输入正确的邮箱");i.auth.default.reset({email:a}).then(function(e){var t=c.ERROR_CODE.OK==e.data.error_code;(n.success=t)?n.email=a:n.toast(e.data.error_desc)})}}angular.module("app").controller("ForgetController",e),e.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval"]}();
!function(){"use strict";function t(t,e){t.state("forget",{needAuth:!1,url:"/forget",title:"找回密码",templateUrl:"modules/forget/forget.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(t,e,o,n,i,r,a,c,u,l,p,d,s,f){var h=10,g=4;e.banners=[],e.notices=[];for(var S={},w=[],T=0;T<g;++T)w.push(S);function m(){c.banner.list({page:1,per_page:h}).then(function(o){e.banners=o,i(function(){e.bannerSwiper=new Swiper(".home-banner",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:300,centeredSlides:!0,autoplay:3e3,autoplayDisableOnInteraction:!1,loop:!0})},1)}),c.product.homeList().then(function(o){e.newArrival=o.recently_products,e.topSale=o.hot_products,e.editorChoice=o.good_products}),e.cartModel.reloadIfNeeded()}e.topSale=w,e.newArrival=w,e.editorChoice=w,e.touchSearch=function(){a.go("search",{})},e.touchCategory=function(o){a.go("search-result",{sortKey:u.SORT_KEY.DEFAULT,sortValue:u.SORT_VALUE.DEFAULT,keyword:null,category:o.id,navTitle:o.name,navStyle:"default"})},e.touchProduct=function(o){a.go("product",{product:o.id})},e.touchGroup=function(o){a.go("home",{})},e.formatUrl=function(o){var t=Math.round((new Date).getTime()/1e3);return-1==o.indexOf("?")?o+"?v="+t:o+"&v="+t},e.reload=m,e.loadMore=function(){},e.cartModel=s,this.$onInit=function(){c.notice.list({page:1,per_page:10}).then(function(o){e.newslist=o,e.autoScroll=function(o){$(o).find("ul").animate({marginTop:"-20px"},500,function(){$(this).css({marginTop:"0px"}).find("li:first").appendTo(this)})},e.noticeScroll=t(function(){e.autoScroll(".tuidie-home .swiper-container")},2e3)})},this.$onDestroy=function(){t.cancel(e.noticeScroll)},c.product.list({page:1,per_page:g,sort_key:u.SORT_KEY.DATE,sort_value:u.SORT_VALUE.DESC}).then(function(o){e.newArrival=o}),e.touchProduct=function(o){a.go("product",{product:o.id})},m()}angular.module("app").controller("HomeController",o),o.$inject=["$interval","$scope","$http","$rootScope","$timeout","$location","$state","API","ENUM","CONSTANTS","$window","AppAuthenticationService","CartModel","ConfigModel"]}();
!function(){"use strict";function e(e,t){e.state("index",{needAuth:!1,url:"?token",title:"首页",templateUrl:"modules/home/home.html"}),e.state("home",{needAuth:!1,cache:!0,url:"/home",title:"首页",templateUrl:"modules/home/home.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(o,t,e,r,u,n,i,c,a){var l=10;function s(){o.isLoading||(o.products=null,o.isEmpty=!1,o.isLoaded=!1,d(1,l))}function d(t,e){o.isLoading=!0;var r={};o.currentCategory&&(r.category=o.currentCategory),o.currentKeyword&&(r.keyword=o.currentKeyword),r.sort_key=o.currentSortKey,r.sort_value=o.currentSortValue,r.page=t,r.per_page=e,i.product.list(r).then(function(t){o.products=o.products?o.products.concat(t):t,o.isEmpty=!o.products||!o.products.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(t&&t.length<e)&&!o.isEmpty})}o.currentSortKey=c.SORT_KEY.DEFAULT,o.currentSortValue=c.SORT_KEY.DESC||0,o.currentKeyword=n.type?n.type:null,o.products=null,o.touchSearch=function(){s()},o.touchSortDefault=function(){var t=c.SORT_KEY.DEFAULT,e=c.SORT_VALUE.DEFAULT;t==o.currentSortKey&&e==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=e,s())},o.touchSortSale=function(){var t=c.SORT_KEY.SALE,e=c.SORT_VALUE.DESC;t==o.currentSortKey&&e==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=e,s())},o.touchSortDate=function(){var t=c.SORT_KEY.DATE,e=c.SORT_VALUE.DESC;t==o.currentSortKey&&e==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=e,s())},o.touchSortPrice=function(t){var e=c.SORT_KEY.PRICE;o.currentSortKey=e,o.currentSortValue=t,s()},o.touchSortCredit=function(){var t=c.SORT_KEY.CREDIT,e=c.SORT_VALUE.DESC;t==o.currentSortKey&&e==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=e,s())},o.touchProduct=function(t){u.go("product",{product:t.id})},o.loadMore=function(){if(o.isLoading)return;if(o.isLastPage)return;if(o.products&&o.products.length){if(o.products.length%10)return;d(o.products.length/l+1,l)}else d(1,l)},o.isEmpty=!1,o.isLoaded=!1,o.isLoading=!1,o.isLastPage=!1,r.height&&$("html, body").animate({scrollTop:r.height},500),s(),o.closeSort=function(){$(".tuidie-homemenu-list .under-navbar .sort-list").removeClass("active"),$(".tuidie-homemenu-list .under-navbar .flex-sort").removeClass("active")},o.toggleSort=function(){$(".tuidie-homemenu-list .under-navbar .sort-list").toggleClass("active"),$(".tuidie-homemenu-list .under-navbar .flex-sort").toggleClass("active"),o.closeFilter()},o.closeFilter=function(){$(".tuidie-homemenu-list .under-navbar .filter-list").removeClass("active"),$(".tuidie-homemenu-list .under-navbar .flex-filter").removeClass("active")},o.toggleFilter=function(){$(".tuidie-homemenu-list .under-navbar .filter-list").toggleClass("active"),$(".tuidie-homemenu-list .under-navbar .flex-filter").toggleClass("active"),o.closeSort()}}angular.module("app").controller("homemenuListController",t),t.$inject=["$scope","$http","$location","homeMenuListResultModel","$state","$stateParams","API","ENUM","CartModel"]}();
!function(){"use strict";function e(e,t){e.state("homemenuList",{needAuth:!1,url:"/home/homemenulist/:type",title:"商品分类",templateUrl:"modules/homemenu-list/homemenu-list.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,e,o,c,u,i,n,r){var a={height:0,products:[]};return a}angular.module("app").factory("homeMenuListResultModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function e(c,e,t,n,o,i,l,u){function s(){return(!c.input.title||!c.input.title.length)&&(!c.selectedType&&!c.selectedContent)}c.input={title:u.title},c.selectedType=u.type,c.selectedContent=u.content,c.types=null,c.contents=null,c.touchType=function(e){c.selectedType=e,c.noInvoice=!1},c.touchContent=function(e){c.selectedContent=e,c.noInvoice=!1},c.touchConfirm=function(){if(c.noInvoice)t.$emit("invoiceChanged",{title:null,type:null,content:null}),c.goBack();else{if(!c.types)return void c.toast("请选择发票类型");if(!c.contents)return void c.toast("请选择发票明细");if(!c.input.title||!c.input.title.length)return void c.toast("请填写发票抬头");t.$emit("invoiceChanged",{title:c.input.title,type:c.selectedType,content:c.selectedContent}),c.goBack()}},c.touchToggle=function(){c.noInvoice=!c.noInvoice,c.noInvoice&&(c.input.title=null,c.selectedType=null,c.selectedContent=null)},c.noInvoice=s(),i.invoice.typeList({}).then(function(e){for(var t=new Array,n=0;n<e.length;n++){var o=e[n];o.name.length&&t.push(o)}c.types=t;var i=c.selectedType;if(i)for(n=0;n<e.length;++n)if(e[n].id==i.id){c.selectedType=e[n];break}c.noInvoice=s()}),i.invoice.contentList({}).then(function(e){c.contents=e;var t=c.selectedContent;if(t)for(var n=0;n<e.length;++n)if(e[n].id==t.id){c.selectedContents=e[n];break}c.noInvoice=s()})}angular.module("app").controller("InvoiceSelectController",e),e.$inject=["$scope","$http","$rootScope","$stateParams","$state","API","ENUM","InvoiceSelectService"]}();
!function(){"use strict";function e(e,t){e.state("invoice-select",{needAuth:!0,url:"/invoice-select",title:"发票信息",templateUrl:"modules/invoice-select/invoice-select.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,n,e,l,c,u){var i={title:null,type:null,content:null,clear:function(){this.title=null,this.type=null,this.content=null}};return i}angular.module("app").factory("InvoiceSelectService",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","ENUM"]}();
!function(){"use strict";function e(t,e,d,s,o,n,i,r,l,a){t.touchCreate=function(){t.addressEditModel.clear(),t.addressEditModel.consignee=null,n.go("address-edit",{})},t.touchModify=function(e){t.addressEditModel.clear(),t.addressEditModel.consignee=e,n.go("address-edit",{})},t.myAddressModel=a,t.addressEditModel=l,t.touchDefaultAddress=function(o){i.consignee.setDefault({consignee:o.id}).then(function(e){if(e)for(var d=0;d<t.myAddressModel.consignees.length;d++){var s=t.myAddressModel.consignees[d];s.id==o.id?s.is_default=!0:s.is_default=!1}else t.toast("设置失败")})},t.isDefaultAddress=function(e){return!!e.is_default},t.myAddressModel.reload()}angular.module("app").controller("MyAddressController",e),e.$inject=["$scope","$http","$rootScope","$stateParams","$location","$state","API","ENUM","AddressEditModel","MyAddressModel"]}();
!function(){"use strict";function e(e,t){e.state("my-address",{needAuth:!0,url:"/my-address",title:"地址管理",templateUrl:"modules/my-address/my-address.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function i(i,e,s,t,n,o,a,c){var r={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,consignees:null,reload:function(){if(!o.getToken())return;if(this.isLoading)return;this.consignees=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1;var e=this;a.consignee.list({}).then(function(i){e.consignees=i,e.isEmpty=!e.consignees||!e.consignees.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=!0})}};return r}angular.module("app").factory("MyAddressModel",i),i.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function t(t,e,a,n,i,s,c,o){var h={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,fetch:function(t,e){if(!s.getToken())return;this.isLoading=!0;var a={page:t,per_page:e};null!=this.status&&(a.status=this.status);var n=this;c.balance.list(a).then(function(t){n.balances=n.balances?n.balances.concat(t):t,n.isEmpty=!n.balances||!n.balances.length,n.isLoaded=!0,n.isLoading=!1,n.isLastPage=!!(t&&t.length<e)&&!n.isEmpty})},reload:function(){if(!s.getToken())return;if(this.isLoading)return;this.balances=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,10),this.get()},get:function(){if(!s.getToken())return;var e=this;c.balance.get({}).then(function(t){e.balanceAmount=t})},loadMore:function(){if(!s.getToken())return;if(this.isLoading)return;if(this.isLastPage)return;this.balances&&this.balances.length?this.fetch(this.balances.length/10+1,10):this.fetch(1,10)},balances:[],balanceAmount:0};return h}angular.module("app").factory("BalanceModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function o(a,o,t,n,e,i,l,r){a.touchBalanceDetail=function(){e.go("balance-history",{})},a.touchWithDrawHistory=function(){e.go("withdraw-history",{})},a.touchWithDraw=function(){a.showDialog=!0},a.touchDialogCancel=function(){a.showDialog=!1,a.input.memo="",a.input.withdraw=""},a.touchDialogConfirm=function(){var o=parseFloat(a.input.withdraw);if(isNaN(o))return void a.toast("请输入数字");if(o<=0)return void a.toast("金额不能小于零");if(o>parseFloat(a.balanceModel.balanceAmount))return void a.toast("金额超出提现范围");if(0==a.input.memo.length)return void a.toast("Memo不能为空");var t={};t.cash=o,t.memo=a.input.memo,l.withdraw.submit(t).then(function(o){a.balanceModel.reload(),a.cancellingOrder=null,a.showDialog=!1,e.go("withdraw-success",{withdraw:o.cash,member_memo:o.member_memo})})},a.touchWithDrawAll=function(){a.input.withdraw=parseFloat(a.balanceModel.balanceAmount)},a.balanceModel=r,a.input={withdraw:"",memo:""},a.balanceModel.reload()}angular.module("app").controller("MyBalanceController",o),o.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","BalanceModel"]}();
!function(){"use strict";function e(e,t){e.state("my-balance",{needAuth:!0,url:"/my-balance",title:"可用资金",templateUrl:"modules/my-balance/my-balance.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,A,a,T,e,s,r){t.TAB_AVAILABLE=0,t.TAB_EXPIRED=1,t.TAB_USED=2,t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel=s,"available"==T.tab?(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=r.CASHGIFT_STATUS.AVAILABLE):"expired"==T.tab?(t.currentTab=t.TAB_EXPIRED,t.myCashgiftModel.status=r.CASHGIFT_STATUS.EXPIRED):"used"==T.tab?(t.currentTab=t.TAB_USED,t.myCashgiftModel.status=r.CASHGIFT_STATUS.USED):(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=r.CASHGIFT_STATUS.AVAILABLE),t.touchTabAvailable=function(){t.currentTab!=t.TAB_AVAILABLE&&(t.currentTab=t.TAB_AVAILABLE,t.myCashgiftModel.status=r.CASHGIFT_STATUS.AVAILABLE,t.myCashgiftModel.reload())},t.touchTabExpired=function(){t.currentTab!=t.TAB_EXPIRED&&(t.currentTab=t.TAB_EXPIRED,t.myCashgiftModel.status=r.CASHGIFT_STATUS.EXPIRED,t.myCashgiftModel.reload())},t.touchTabUsed=function(){t.currentTab!=t.TAB_USED&&(t.currentTab=t.TAB_USED,t.myCashgiftModel.status=r.CASHGIFT_STATUS.USED,t.myCashgiftModel.reload())},t.myCashgiftModel.reload()}angular.module("app").controller("MyCashgiftController",t),t.$inject=["$scope","$http","$location","$stateParams","$state","MyCashgiftModel","ENUM"]}();
!function(){"use strict";function t(t,e){t.state("my-cashgift",{needAuth:!0,url:"/my-cashgift",title:"我的红包",templateUrl:"modules/my-cashgift/my-cashgift.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,i,s,a,e,h,n,c){var g={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,status:null,cashgifts:null,fetch:function(t,i){if(!h.getToken())return;this.isLoading=!0;var s={page:t,per_page:i};s.status=this.status;var a=this;n.cashgift.list(s).then(function(t){a.cashgifts=a.cashgifts?a.cashgifts.concat(t):t,a.isEmpty=!a.cashgifts||!a.cashgifts.length,a.isLoaded=!0,a.isLoading=!1,a.isLastPage=!!(t&&t.length<i)&&!a.isEmpty})},reload:function(){if(!h.getToken())return;if(this.isLoading)return;this.cashgifts=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,10)},loadMore:function(){if(!h.getToken())return;if(this.isLoading)return;if(this.isLastPage)return;this.cashgifts&&this.cashgifts.length?this.fetch(this.cashgifts.length/10+1,10):this.fetch(1,10)}};return g}angular.module("app").factory("MyCashgiftModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function o(e,t,o,r,c){e.myFavoriteModel=c,e.touchProduct=function(o){t.go("product",{product:o.id})},e.touchDelete=function(o){e.myFavoriteModel.delete(o.id)},e.myFavoriteModel.reload()}angular.module("app").controller("MyFavoriteController",o),o.$inject=["$scope","$state","API","ENUM","MyFavoriteModel"]}();
!function(){"use strict";function t(t,e){t.state("my-favorite",{needAuth:!0,url:"/my-favorite",title:"我的收藏",templateUrl:"modules/my-favorite/my-favorite.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,i,e,s,o,n,r,c){var u={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,products:null,fetch:function(t,i){this.isLoading=!0;var e=this;r.product.likedList({page:t,per_page:i}).then(function(t){e.products=e.products?e.products.concat(t):t,e.isEmpty=!e.products||!e.products.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=!!(t&&t.length<i)&&!e.isEmpty})},reload:function(){if(!n.getToken())return;if(this.isLoading)return;this.products=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,10)},loadMore:function(){if(this.isLoading)return;if(this.isLastPage)return;this.products&&this.products.length?this.fetch(this.products.length/10+1,10):this.fetch(1,10)},delete:function(t){if(!n.getToken())return;var i=this;r.product.unlike({product:t}).then(function(t){i.reload()})}};return u}angular.module("app").factory("MyFavoriteModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function r(e,r,o,t,d,n,l,a,c,u,T,E){e.TAB_ALL=0,e.TAB_CREATED=1,e.TAB_PAID=2,e.TAB_DELIVERING=3,e.TAB_DELIVERIED=4,e.currentTab=e.TAB_ALL,e.cancellingOrder=null,e.showDialog=!1,e.myOrderModel=T,e.paymentModel=u,e.orderExpressModel=E,"all"==l.tab?(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null):"created"==l.tab?(e.currentTab=e.TAB_CREATED,e.myOrderModel.status=c.ORDER_STATUS.CREATED):"paid"==l.tab?(e.currentTab=e.TAB_PAID,e.myOrderModel.status=c.ORDER_STATUS.PAID):"delivering"==l.tab?(e.currentTab=e.TAB_DELIVERING,e.myOrderModel.status=c.ORDER_STATUS.DELIVERING):"delivered"==l.tab?(e.currentTab=e.TAB_DELIVERIED,e.myOrderModel.status=c.ORDER_STATUS.DELIVERIED):(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null),e.touchTabAll=function(){e.currentTab!=e.TAB_ALL&&(e.currentTab=e.TAB_ALL,e.myOrderModel.status=null,e.myOrderModel.reload())},e.touchTabCreated=function(){e.currentTab!=e.TAB_CREATED&&(e.currentTab=e.TAB_CREATED,e.myOrderModel.status=c.ORDER_STATUS.CREATED,e.myOrderModel.reload())},e.touchTabPaid=function(){e.currentTab!=e.TAB_PAID&&(e.currentTab=e.TAB_PAID,e.myOrderModel.status=c.ORDER_STATUS.PAID,e.myOrderModel.reload())},e.touchTabDelivering=function(){e.currentTab!=e.TAB_DELIVERING&&(e.currentTab=e.TAB_DELIVERING,e.myOrderModel.status=c.ORDER_STATUS.DELIVERING,e.myOrderModel.reload())},e.touchTabDeliveried=function(){e.currentTab!=e.TAB_DELIVERIED&&(e.currentTab=e.TAB_DELIVERIED,e.myOrderModel.status=c.ORDER_STATUS.DELIVERIED,e.myOrderModel.reload())},e.touchDialogCancel=function(){e.cancellingOrder=null,e.showDialog=!1},e.touchDialogConfirm=function(){a.order.cancel({order:e.cancellingOrder.id,reason:1}).then(function(r){e.myOrderModel.reload(),e.cancellingOrder=null,e.showDialog=!1})},e.touchOrder=function(r){n.go("order-detail",{order:r.id})},e.touchPay=function(r){r&&(e.paymentModel.clear(),e.paymentModel.order=r,n.go("payment",{}))},e.touchCancel=function(r){e.cancellingOrder=r,e.showDialog=!0},e.touchConfirm=function(r){a.order.confirm({order:r.id}).then(function(r){n.go("confirm-delivery",{order:r.id})})},e.touchExpress=function(r){e.orderExpressModel.clear(),e.orderExpressModel.order=r,n.go("order-express",{order:r.id})},e.touchComment=function(r){n.go("order-review",{order:r.id})},e.myOrderModel.reload()}angular.module("app").controller("MyOrderController",r),r.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyOrderModel","OrderExpressModel"]}();
!function(){"use strict";function e(e,r){e.state("my-order",{needAuth:!0,url:"/my-order?tab",title:"我的订单",templateUrl:"modules/my-order/my-order.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,s,i,e,r,n,o,a){var h={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,status:null,orders:null,fetch:function(t,s){if(!n.getToken())return;this.isLoading=!0;var i={page:t,per_page:s};null!=this.status&&(i.status=this.status);var e=this;o.order.list(i).then(function(t){e.orders=e.orders?e.orders.concat(t):t,e.isEmpty=!e.orders||!e.orders.length,e.isLoaded=!0,e.isLoading=!1,e.isLastPage=!!(t&&t.length<s)&&!e.isEmpty})},reload:function(){if(!n.getToken())return;if(this.isLoading)return;this.orders=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,10)},loadMore:function(){if(!n.getToken())return;if(this.isLoading)return;if(this.isLastPage)return;this.orders&&this.orders.length?this.fetch(this.orders.length/10+1,10):this.fetch(1,10)}};return h}angular.module("app").factory("MyOrderModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function o(o,e,n,t,c,l,m,d){o.myRecommendModel=d,o.myRecommendModel.reload()}angular.module("app").controller("MyRecommendController",o),o.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","MyRecommendModel"]}();
!function(){"use strict";function e(e,m){e.state("my-recommend",{needAuth:!0,url:"/my-recommend",title:"可用资金",templateUrl:"modules/my-recommend/my-recommend.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,e,n,o,i,r,c,u){var f={reload:function(){if(!r.getToken())return;this.fetch(),this.getChildren()},fetch:function(){if(!r.getToken())return;var e=this;c.recommend.bonusInfo({}).then(function(t){e.bonus_info=t})},getChildren:function(){if(!r.getToken())return;var e=this;c.user.getChildren().then(function(t){e.children=t})}};return f}angular.module("app").factory("MyRecommendModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function e(e,o,t,r,c,T,a,l,n,u,E){e.TAB_ALL=0,e.TAB_INCOME=1,e.TAB_EXPENDITURE=2,e.currentTab=e.TAB_ALL,e.myScoreModel=E,e.paymentModel=u,"all"==a.tab?(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null):"income"==a.tab?(e.currentTab=e.TAB_INCOME,e.myScoreModel.status=n.SCORE_STATUS.INCOME):"expenditure"==a.tab?(e.currentTab=e.TAB_EXPENDITURE,e.myScoreModel.status=n.SCORE_STATUS.EXPENDITURE):(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null),e.touchTabAll=function(){e.currentTab!=e.TAB_ALL&&(e.currentTab=e.TAB_ALL,e.myScoreModel.status=null,e.myScoreModel.reload())},e.touchTabIncome=function(){e.currentTab!=e.TAB_INCOME&&(e.currentTab=e.TAB_INCOME,e.myScoreModel.status=n.SCORE_STATUS.INCOME,e.myScoreModel.reload())},e.touchTabExpenditure=function(){e.currentTab!=e.TAB_EXPENDITURE&&(e.currentTab=e.TAB_EXPENDITURE,e.myScoreModel.status=n.SCORE_STATUS.EXPENDITURE,e.myScoreModel.reload())},e.myScoreModel.count(),e.myScoreModel.reload()}angular.module("app").controller("MyScoreController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","MyScoreModel"]}();
!function(){"use strict";function e(e,t){e.state("my-score",{needAuth:!0,url:"/my-score?tab",title:"我的积分",templateUrl:"modules/my-score/my-score.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,i,s,e,o,n,r,h){var a={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,score:null,rule:null,history:null,count:function(){if(!n.getToken())return;var i=this;r.score.get({}).then(function(t){i.score=t.score,i.rule=t.rule})},fetch:function(t,i){this.isLoading=!0;var s=this,e={page:t,per_page:i};this.status&&(e.status=this.status);r.score.historyList(e).then(function(t){s.history=s.history?s.history.concat(t):t,s.isEmpty=!s.history||!s.history.length,s.isLoaded=!0,s.isLoading=!1,s.isLastPage=!!(t&&t.length<i)&&!s.isEmpty})},reload:function(){if(!n.getToken())return;if(this.isLoading)return;this.history=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,10)},loadMore:function(){if(!n.getToken())return;if(this.isLoading)return;if(this.isLastPage)return;this.history&&this.history.length?this.fetch(this.history.length/10+1,10):this.fetch(1,10)}};return a}angular.module("app").factory("MyScoreModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function o(o,t,n,e,c,i,l){}angular.module("app").controller("MyWeixinController",o),o.$inject=["$scope","$http","$window","$location","$state","$rootScope","API"]}();
!function(){"use strict";function e(e,i){e.state("my-weixin",{needAuth:!0,url:"/my-weixin",title:"微信",templateUrl:"modules/my-weixin/my-weixin.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(n,o,r,e,t,d,i,a,c,s,u){var l=i.order;function m(){n.isLoading=!0,n.isLoaded=!1,a.order.get({order:l}).then(function(o){var r=(n.order=o).promos;for(var e in n.promos=[],r)"score"==r[e].promo?r[e].name="积分":"cashgift"==r[e].promo?r[e].name="红包":"preferential"==r[e].promo?r[e].name="优惠金额":"goods_reduction"==r[e].promo?r[e].name="商品减免":"order_reduction"==r[e].promo?r[e].name="订单减免":"coupon_reduction"==r[e].promo&&(r[e].name="优惠券减免");n.promos=r,n.isLoading=!1,n.isLoaded=!0})}n.order={id:l},n.isLoading=!1,n.isLoaded=!1,n.touchPay=function(){if(!n.order)return;n.paymentModel.clear(),n.paymentModel.order=n.order,d.go("payment",{})},n.touchCancel=function(){if(!n.order)return;n.showDialog=!0},n.touchConfirm=function(){a.order.confirm({order:l}).then(function(o){n.toast("确认成功"),m()})},n.touchExpress=function(){n.orderExpressModel.clear(),n.orderExpressModel.order=n.order,d.go("order-express",{order:n.order.id})},n.touchComment=function(){d.go("order-review",{order:n.order.id})},n.touchProduct=function(o){d.go("product",{product:o.id})},n.showDialog=!1,n.touchDialogCancel=function(){n.showDialog=!1},n.touchDialogConfirm=function(){a.order.cancel({order:l,reason:1}).then(function(o){n.toast("取消成功"),n.showDialog=!1,m()})},n.paymentModel=s,n.orderExpressModel=u,m()}angular.module("app").controller("OrderDetailController",o),o.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","PaymentModel","OrderExpressModel"]}();
!function(){"use strict";function e(e,r){e.state("order-detail",{needAuth:!0,url:"/order-detail/?order",title:"订单详情",templateUrl:"modules/order-detail/order-detail.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(e,r,o,t,s,l,d,n,a,p){e.orderExpressModel=p,e.orderExpressModel.reload()}angular.module("app").controller("OrderExpressController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","OrderExpressModel"]}();
!function(){"use strict";function e(e,r){e.state("order-express",{needAuth:!0,url:"/order-express/?order",title:"物流信息",templateUrl:"modules/order-express/order-express.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,n,r,e,i,o,u,c){var l={order:null,info:null,clear:function(){this.order=null,this.info=null},reload:function(){var n=this;return u.shipping.statusGet({order_id:this.order.id,tracking_no:null}).then(function(t){return!!(n.info=t)})}};return l}angular.module("app").factory("OrderExpressModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function e(n,e,o,r,i,t,d,s,u){var v=d.order;n.order={id:v},n.isLoading=!1,n.isLoaded=!1,n.isAnonymous=0,n.touchGood=function(e){e.review||(e.review={});e.review.goods=e.id,e.review.grade=u.ORDER_GRADE.GOOD,e.review.content||(e.review.content="")},n.touchMedium=function(e){e.review||(e.review={});e.review.goods=e.id,e.review.grade=u.ORDER_GRADE.MEDIUM,e.review.content||(e.review.content="")},n.touchBad=function(e){e.review||(e.review={});e.review.goods=e.id,e.review.grade=u.ORDER_GRADE.BAD,e.review.content||(e.review.content="")},n.touchSetAnonymous=function(){n.isAnonymous=!n.isAnonymous},n.touchSubmit=function(){for(var e=[],o=0;o<n.order.goods.length;o++){var r=n.order.goods[o];if(r.review){if(!r.review.grade)return void n.toast("请选择评价");e.push(r.review)}}if(e.length<n.order.goods.length)return void n.toast("请评价全部商品");var i={};i.order=v,i.review=JSON.stringify(e),n.isAnonymous?i.is_anonymous=1:i.is_anonymous=0;s.order.review(i).then(function(e){e&&t.go("review-success",{order:n.order.id})})},n.isLoading=!0,n.isLoaded=!1,s.order.get({order:v}).then(function(e){n.order=e,n.isLoading=!1,n.isLoaded=!0})}angular.module("app").controller("OrderReviewController",e),e.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM"]}();
!function(){"use strict";function e(e,r){e.state("order-review",{needAuth:!0,url:"/order-review?order",title:"订单评价",templateUrl:"modules/order-review/order-review.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(t,e,o,a,r,n,c,d,i,p){p.order?(t.selectedType=null,t.paymentModel=p,t.isSelected=function(e){if(!t.selectedType)return!1;if(e.code==t.selectedType.code)return!0;return!1},t.touchSelect=function(e){t.selectedType=e},t.touchSubmit=function(){if(!t.selectedType)return void t.toast("请选择支持方式");switch(t.selectedType.code){case"alipay.app":case"alipay.wap":a.go("alipay-wap",{order:p.order.id});break;case"wxpay.app":case"wxpay.web":r.isWeixin()?a.go("wechat-pay",{order:p.order.id}):t.toast("暂不支持此方式");break;case"unionpay.app":t.toast("暂不支持此方式");break;case"teegon.wap":a.go("teegon",{order:p.order.id});break;default:t.toast("暂不支持此方式")}},t.touchDetail=function(){a.go("order-detail",{order:t.paymentModel.order.id})},t.paymentModel.reload().then(function(e){})):n(function(){r.goHome()},1)}angular.module("app").controller("PaymentController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel"]}();
!function(){"use strict";function t(t,e){t.state("payment",{needAuth:!1,url:"/payment",title:"收银台",templateUrl:"modules/payment/payment.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,e,n,o,r,i,u,a){var s={isEmpty:!1,isLoaded:!1,isLoading:!1,types:null,order:null,reload:function(){if(!i.getToken())return;var e=this;return u.payment.typeList({}).then(function(t){return t&&(e.types=t,e.isEmpty=!e.groups||!e.groups.length,e.isLoaded=!0,e.isLoading=!1),!!t})},clear:function(){this.order=null}};return s}angular.module("app").factory("PaymentModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function t(t,o,e,r,a){var n=a.order;t.reason=a.reason,t.touchDetail=function(){r.go("order-detail",{order:n})}}angular.module("app").controller("PaymentFailedController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}();
!function(){"use strict";function e(e,t){e.state("payment-failed",{needAuth:!0,url:"/payment-failed?order&reason",title:"支付失败",templateUrl:"modules/payment-failed/payment-failed.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,o,e,r,a){var n=a.order;t.touchDetail=function(){r.go("order-detail",{order:n})}}angular.module("app").controller("PaymentSuccessController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}();
!function(){"use strict";function e(e,t){e.state("payment-success",{needAuth:!0,url:"/payment-success?order",title:"付款成功",templateUrl:"modules/payment-success/payment-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(l,t,r,s,n,e,o,p,d,i,c,u,f){var g=3,h=o.product;function m(){var t=[].concat(l.currentAttrs).concat(l.optionalAttrs);l.currentSelectedPrice=parseFloat(l.product.current_price);for(var r=0;r<l.product.properties.length;++r){var n=l.product.properties[r];for(var e in n.attrs){-1!=t.indexOf(n.attrs[e].id)&&n.attrs[e].attr_price&&(l.currentSelectedPrice+=parseFloat(n.attrs[e].attr_price))}}}function k(){var t=l.product,r=!1;if(!t||!t.good_stock)return!1;for(var n in t.properties)if(!t.properties[n].is_multiselect){r=!0;break}if(r){if(!l.currentAttrs||!l.currentAttrs.length)return!1;if(!a([].concat(l.currentAttrs)))return!1;if(!l.currentStock)return!1}return!0}function a(t){for(var r=0;r<l.product.stock.length;r++){var n=l.product.stock[r],e=n.goods_attr.split("|");e.sort(function(t,r){return t-r});for(var o=0;o<t.length;o++){var i=t[o];t[o]=i.toString()}if(t.sort(function(t,r){return t-r}),A(e,t)&&0<n.stock_number)return!0}return!1}function A(t,r){if(t.length<r.length)return!1;for(var n=0,e=r.length;n<e;n++)if(-1==t.indexOf(r[n]))return!1;return!0}function v(){l.isLoading=!0,p.product.get({product:h}).then(function(t){if(t.properties.sort(function(t,r){return t.is_multiselect-r.is_multiselect}),l.product=t,l.isLoaded=!0,l.isLoading=!1,l.canPurchase=k(),f.fetchWeChat().then(function(t){if(t){var r=t["wechat.web"];r&&function(t,r){if(!t)return;var n=r.share_url?r.share_url:r.share_link;wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:t.app_id,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["chooseWXPay","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:"商品详情",desc:r.name,link:n,imgUrl:r.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:"商品详情",desc:r.name,link:n,imgUrl:r.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:"商品详情",desc:r.name,link:n,imgUrl:r.default_photo.large,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:"商品详情",desc:r.name,link:n,imgUrl:r.default_photo.large,success:function(){},cancel:function(){}})}),wx.error(function(t){GLOBAL_CONFIG.DEBUG&&$rootScope.toast(JSON.stringify(t))})}(r,l.product)}}),t.photos&&1<t.photos.length)s(function(){l.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:1500,autoplayDisableOnInteraction:!1,loop:!0})},1);else s(function(){l.flashSwiper=new Swiper(".product-flash",{pagination:".swiper-pagination",paginationClickable:!1,spaceBetween:30,centeredSlides:!0,autoplay:0,autoplayDisableOnInteraction:!1,loop:!1})},1);for(var r=[],n=null,e=0;e<t.stock.length;e++){var o=t.stock[e];if(0<o.stock_number){var i=o.goods_attr.split("|");for(e=0;e<i.length;e++){var c=i[e];r.push(parseInt(c))}r.sort(function(t,r){return t-r});break}}if(r.length){var u=r.join("|");for(e=0;e<t.stock.length;++e){var a=t.stock[e].goods_attr.split("|");if(a.sort(function(t,r){return t-r}),a.join("|")==u){n=t.stock[e];break}}}l.currentAttrs=r,l.currentStock=n,l.canPurchase=k(),m(),function(){if(!l.product)return;p.review.productList({product:h,grade:d.REVIEW_GRADE.ALL,page:1,per_page:g}).then(function(t){l.comments=t})}()})}l.currentStock=null,l.currentAttrs=[],l.currentSelectedPrice=0,l.input={currentAmount:1},l.optionalAttrs=[],l.canPurchase=!1,l.product=null,l.comments=[],l.cartModel=u,l.touchAmountSub=function(){if(!k())return;if(!l.product)return;if(l.product.stock&&l.product.stock.length&&!l.currentStock)return;var t=parseInt(l.input.currentAmount);if(t<=1)return void l.toast("受不了了，宝贝不能再少了");l.input.currentAmount=t-1},l.touchAmountAdd=function(){if(!k())return;if(!l.product)return;if(l.product.stock&&l.product.stock.length){if(!l.currentStock)return;var t=parseInt(l.input.currentAmount),r=parseInt(l.currentStock.stock_number);if(r<=t)return void l.toast("达到最大库存");l.input.currentAmount=t+1}else{var t=parseInt(l.input.currentAmount),r=l.product.good_stock;if(r<=t)return;l.input.currentAmount=t+1}},l.touchAttr=function(t,r){if(!l.product)return;var n=l.product;if(r.is_multiselect){var e=[].concat(l.optionalAttrs),o=e.indexOf(r.id);-1==o?e.push(r.id):e.splice(o,1),l.optionalAttrs=e,m()}else{var i=null,e=[].concat(l.currentAttrs),o=e.indexOf(r.id);for(var c in t.attrs)if(t.attrs[c].id!=r.id){var o=e.indexOf(t.attrs[c].id);-1!=o&&e.splice(o,1)}if(e.push(r.id),(e=e.filter(function(t,r,n){return n.indexOf(t)===r})).sort(function(t,r){return t-r}),e.length)for(var u=e.join("|"),c=0;c<n.stock.length;++c){var a=n.stock[c].goods_attr,s=a.split("|");s.sort(function(t,r){return t-r});var p=s.join("|");if(p==u){i=n.stock[c];break}}l.currentAttrs=e,l.currentStock=i,l.canPurchase=k(),m()}},l.touchLike=function(){if(!i.getToken())return void l.goSignin();l.product.is_liked?(l.product.is_liked=!1,p.product.unlike({product:h}).then(function(t){l.product.is_liked=t,l.toast("取消收藏")},function(t){l.product.is_liked=!0})):(l.product.is_liked=!0,p.product.like({product:h}).then(function(t){l.product.is_liked=t,l.toast("收藏成功")},function(t){l.product.is_liked=!1}))},l.touchComments=function(){e.go("comment",{product:h})},l.touchComment=function(t){e.go("comment",{product:h})},l.touchCart=function(){if(!i.getToken())return void l.goSignin();e.go("cart-select",{})},l.touchAddCart=function(){if(!k())return;if(!i.getToken())return void l.goSignin();var t=[].concat(l.currentAttrs).concat(l.optionalAttrs),r=Number(l.input.currentAmount);u.add(h,t,r).then(function(t){t&&l.toast("已添加到购物车")})},l.touchPurchase=function(){if(!k())return;if(!i.getToken())return void l.goSignin();var t=l.product,r=[].concat(l.currentAttrs).concat(l.optionalAttrs),n=Number(l.input.currentAmount);c.clear(),c.product=t,c.attrs=r,c.amount=n,e.go("confirm-product",{})},l.refreshAmount=function(){var t=parseInt(l.input.currentAmount),r=parseInt(l.currentStock.stock_number);r<t&&(l.toast("达到最大库存"),l.input.currentAmount=r);t<1&&(l.input.currentAmount=1)},l.formatGrade=function(t){{if(d.REVIEW_GRADE.BAD==t)return"差评";if(d.REVIEW_GRADE.MEDIUM==t)return"中评";if(d.REVIEW_GRADE.GOOD==t)return"好评"}return"中评"},l.isAttrSelected=function(t){return t.is_multiselect?-1==l.optionalAttrs.indexOf(t.id)?"unSelected":"selected":-1==l.currentAttrs.indexOf(t.id)?"unSelected":"selected"},l.isLoading=!1,l.isLoaded=!1,v()}angular.module("app").controller("ProductController",t),t.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","ConfirmProductService","CartModel","ConfigModel"]}();
!function(){"use strict";function t(t,r){t.state("product",{needAuth:!1,url:"/product?product",title:"商品详情",templateUrl:"modules/product/product.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(e,o,t,n,r,c,i,u,a){e.touchAllOrders=function(){r.go("my-order",{tab:"all"})},e.touchOrderCreated=function(){r.go("my-order",{tab:"created"})},e.touchOrderPayed=function(){r.go("my-order",{tab:"paid"})},e.touchOrderDelivering=function(){r.go("my-order",{tab:"delivering"})},e.touchOrderDelivered=function(){r.go("my-order",{tab:"delivered"})},e.touchFav=function(){r.go("my-favorite",{})},e.touchAddress=function(){r.go("my-address",{})},e.touchScore=function(){r.go("my-score",{tab:"all"})},e.touchCashGift=function(){r.go("my-cashgift",{})},e.touchHelps=function(){r.go("article",{})},e.touchPassword=function(){r.go("change-password",{})},e.touchSignin=function(){i.getToken()||e.goSignin()},e.touchSignout=function(){i.getToken()&&c.auth.base.signout().then(function(o){o?(e.goHome(),e.toast("注销成功")):e.toast("注销失败")})},e.touchBonus=function(){r.go("bonus",{})},e.touchBalance=function(){r.go("my-balance",{})},e.isSignIn=d,e.touchRecommend=function(){r.go("my-recommend",{})},e.isWeixin=function(){return t.isWeixin()},e.cartModel=u,e.user=i.getUser(),e.userName="",a.fetch();var s=a.getConfig();function d(){return i.getToken()}e.authorize=s.authorize,d()&&c.user.profileGet().then(function(o){i.setUser(o),(e.user=o).nickname?e.userName=o.nickname:e.userName=o.username}),e.cartModel.reloadIfNeeded()}angular.module("app").controller("ProfileController",o),o.$inject=["$scope","$http","$rootScope","$location","$state","API","AppAuthenticationService","CartModel","ConfigModel"]}();
!function(){"use strict";function e(e,t){e.state("profile",{needAuth:!0,url:"/profile",title:"个人中心",templateUrl:"modules/profile/profile.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(o,t,n,e,c){var a=encodeURIComponent(n.location.protocol+"//"+n.location.host+n.location.pathname),r=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=3&referer="+a;n.location.href=r}angular.module("app").controller("QQAuthController",o),o.$inject=["$scope","$http","$window","$location","$timeout"]}();
!function(){"use strict";function t(t,e){t.state("qq-auth",{needAuth:!1,url:"/qq-auth",title:"QQ登录",controller:"QQAuthController",templateUrl:"modules/qq-auth/qq-auth.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(o,e,t,n,c){c.order;o.reason=c.reason,o.touchToHome=function(){n.go("home",{})}}angular.module("app").controller("ReviewSuccessController",o),o.$inject=["$scope","$http","$location","$state","$stateParams"]}();
!function(){"use strict";function e(e,s){e.state("review-success",{needAuth:!0,url:"/review-success?order",title:"评价成功",templateUrl:"modules/review-success/review-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(o,t,r,e,u,n,c,S,a,l){var i=10;function s(){o.isLoading||(o.products=null,o.isEmpty=!1,o.isLoaded=!1,E(1,i))}function E(t,r){o.isLoading=!0;var e={};o.currentCategory&&(e.category=o.currentCategory),o.currentKeyword&&(e.keyword=o.currentKeyword),e.sort_key=o.currentSortKey,e.sort_value=o.currentSortValue,e.page=t,e.per_page=r,a.product.list(e).then(function(t){o.products=o.products?o.products.concat(t):t,o.isEmpty=!o.products||!o.products.length,o.isLoaded=!0,o.isLoading=!1,o.isLastPage=!!(t&&t.length<r)&&!o.isEmpty})}o.currentSortKey=S.sortKey?S.sortKey:l.SORT_KEY.DEFAULT,o.currentSortValue=S.sortValue?S.sortValue:l.SORT_KEY.DESC,o.currentKeyword=S.keyword?S.keyword:null,o.currentCategory=S.category,o.navTitle=S.navTitle,o.navStyle=S.navStyle,o.navStyle||(o.navStyle="default"),o.products=null,o.touchSearch=function(){s()},o.touchSortDefault=function(){var t=l.SORT_KEY.DEFAULT,r=l.SORT_VALUE.DEFAULT;t==o.currentSortKey&&r==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=r,s())},o.touchSortSale=function(){var t=l.SORT_KEY.SALE,r=l.SORT_VALUE.DESC;t==o.currentSortKey&&r==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=r,s())},o.touchSortDate=function(){var t=l.SORT_KEY.DATE,r=l.SORT_VALUE.DESC;t==o.currentSortKey&&r==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=r,s())},o.touchSortPrice=function(){var t=l.SORT_KEY.PRICE,r=l.SORT_VALUE.DESC;o.currentSortKey==l.SORT_KEY.PRICE?o.currentSortValue==l.SORT_VALUE.DEFAULT||o.currentSortValue==l.SORT_VALUE.ASC?(t=l.SORT_KEY.PRICE,r=l.SORT_VALUE.DESC):(t=l.SORT_KEY.PRICE,r=l.SORT_VALUE.ASC):(t=l.SORT_KEY.PRICE,r=l.SORT_VALUE.DESC);t==o.currentSortKey&&r==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=r,s())},o.touchSortCredit=function(){var t=l.SORT_KEY.CREDIT,r=l.SORT_VALUE.DESC;t==o.currentSortKey&&r==o.currentSortValue||(o.currentSortKey=t,o.currentSortValue=r,s())},o.touchProduct=function(t){c.go("product",{product:t.id})},o.loadMore=function(){if(o.isLoading)return;if(o.isLastPage)return;if(o.products&&o.products.length){if(o.products.length%10)return;E(o.products.length/i+1,i)}else E(1,i)},o.isEmpty=!1,o.isLoaded=!1,o.isLoading=!1,o.isLastPage=!1,u.height&&$("html, body").animate({scrollTop:u.height},500),s()}angular.module("app").controller("SearchResultController",t),t.$inject=["$scope","$http","$window","$timeout","SearchResultModel","$location","$state","$stateParams","API","ENUM"]}();
!function(){"use strict";function e(e,t){e.state("search-result",{needAuth:!1,url:"/search-result/:keyword/:sortKey/:sortValue/:category/:navTitle/:navStyle",title:"搜索结果",templateUrl:"modules/search-result/search-result.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,e,c,o,r,u,a,i){var n={height:0,products:[]};return n}angular.module("app").factory("SearchResultModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function e(r,e,t,o,n,c,a,u,s){r.currentKeyword="",r.keywords=null,r.history=s.history,r.clear=function(){s.clear(),r.history=s.history},r.touchSearch=function(){if(!r.currentKeyword||r.currentKeyword.length<1)return void r.toast("请输入正确的关键字");n.$emit("searchChanged",r.currentKeyword),c.go("search-result",{sortKey:u.SORT_KEY.DEFAULT,sortValue:u.SORT_VALUE.DEFAULT,keyword:r.currentKeyword,category:null,navTitle:r.currentKeyword,navStyle:"search"})},r.touchKeyword=function(e){if(!e||e.length<1)return void r.toast("请输入正确的关键字");r.currentKeyword=e,n.$emit("searchChanged",e),c.go("search-result",{sortKey:u.SORT_KEY.DEFAULT,sortValue:u.SORT_VALUE.DEFAULT,keyword:e,category:null,navTitle:e,navStyle:"search"})},a.search.keywordList({}).then(function(e){r.keywords=e})}angular.module("app").controller("SearchController",e),e.$inject=["$scope","$http","$window","$timeout","$rootScope","$state","API","ENUM","SearchService"]}();
!function(){"use strict";function e(e,t){e.state("search",{needAuth:!1,url:"/search",title:"搜索",templateUrl:"modules/search/search.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,o,r,i,n,e){var h={};return h.history=null,h.clear=function(){this.history=null},e.$on("searchChanged",function(t,o){o&&o.length&&(-1==(h.history?h.history.indexOf(o):-1)&&(h.history=h.history||[],h.history.push(o)))}),h}angular.module("app").factory("SearchService",t),t.$inject=["$http","$q","$timeout","CacheFactory","ENUM","$rootScope"]}();
!function(){"use strict";function t(o,t,n,i,e,u,r,a,s){o.username="",o.password="",o.touchSignin=function(){var t=o.username,n=o.password;if(!t||t.length<3)return void o.toast("用户名太短");if(!t||25<t.length)return void o.toast("用户名太长");if(!n||n.length<4)return void o.toast("请输入正确的密码");r.auth.base.signin({username:t,password:n}).then(function(t){t?(o.toast("登录成功"),o.goHome()):o.toast("用户名或密码错误")})},o.touchSignup=function(){e.go("signup",{})},o.touchForget=function(){e.go("forget",{})},o.touchWeixin=function(){e.go("wechat-auth",{})},o.touchQQ=function(){e.go("qq-auth",{})},o.isWeixin=function(){var t=s.getConfig();if(!t)return!1;return t["wechat.web"]&&u.isWeixin()}}angular.module("app").controller("SigninController",t),t.$inject=["$scope","$http","$window","$location","$state","$rootScope","API","ENUM","ConfigModel"]}();
!function(){"use strict";function i(i,n){i.state("signin",{needAuth:!1,url:"/signin",title:"用户登录",templateUrl:"modules/signin/signin.html"})}angular.module("app").config(i),i.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(n,e,t,o,a,r,i,s,c,u){n.TAB_MOBILE=0,n.TAB_EMAIL=1,n.currentTab=n.TAB_MOBILE,"mobile"==r.tab?n.currentTab=n.TAB_MOBILE:"email"==r.tab?n.currentTab=n.TAB_EMAIL:n.currentTab=n.TAB_MOBILE,n.touchTabMobile=function(){n.currentTab!=n.TAB_MOBILE&&(n.currentTab=n.TAB_MOBILE,n.signupMobile={show:!0})},n.touchTabEmail=function(){n.currentTab!=n.TAB_EMAIL&&(n.currentTab=n.TAB_EMAIL,n.signupMobile={show:!1})},n.signupMobile={show:!0},n.state={username:"",password:"",password2:"",email:"",mobile:"",mobile_code:"",mobile_password:"",mobile_password2:""},n.touchSignup=function(){var e=n.state.username,t=n.state.password,o=n.state.password2,a=n.state.email;if(!e||e.length<3)return void n.toast("用户名太短");if(!e||25<e.length)return void n.toast("用户名太长");if(!t||t.length<6)return void n.toast("请输入正确的密码");if(t!=o)return n.toast("请输入正确的密码"),void(n.password2="");if(!a||a.length<5)return void n.toast("请输入正确的邮箱地址");var r={};r.username=e,r.password=t,r.email=a,c.getReferences()&&(r.invite_code=parseInt(c.getReferences()));i.auth.default.signup(r).then(function(e){e.data&&s.ERROR_CODE.OK==e.data.error_code?(n.toast("注册成功"),n.goHome()):n.toast(e.data.error_desc)})},n.touchSignupMobile=function(){var e=n.state.mobile,t=n.state.mobile_code,o=n.state.mobile_password,a=n.state.mobile_password2;if(!e||e.length<1)return void n.toast("请输入手机号码");if(!t||6!=t.length)return void n.toast("请输入正确的手机验证码");if(!o||o.length<6)return void n.toast("请输入正确的密码");if(o!=a)return n.toast("请输入正确的密码"),void(n.password2="");var r={};r.mobile=e,r.code=t,r.password=o,c.getReferences()&&(r.invite_code=parseInt(c.getReferences()));i.auth.mobile.signup(r).then(function(e){e.data&&s.ERROR_CODE.OK==e.data.error_code?(n.toast("手机号注册成功"),n.goHome()):n.toast(e.data.error_desc)})},n.toucheMobileCode=function(){if(!n.paraevent)return;var e=n.state.mobile;if(!e||e.length<1)return void n.toast("请输入手机号码");var t={};t.mobile=e,t.code="86",i.auth.mobile.verify(t).then(function(e){e&&i.auth.mobile.send(t).then(function(e){var t,o;e.data&&s.ERROR_CODE.OK==e.data.error_code?(t=60,o=void 0,o=u(function(){t<=0?(u.cancel(o),o=void 0,t=60,n.paracont="重发验证码",n.paraclass="mobile-code",n.paraevent=!0):(n.paracont=t+"s",n.paraclass="not-mobile-code",n.paraevent=!1,t--)},1e3,100)):n.toast(e.data.error_desc)})})},n.touchLicense=function(){t.location.href=n.siteInfo.terms_url},n.siteInfo={},n.paracont="获取验证码",n.paraclass="mobile-code",n.paraevent=!0,i.site.get().then(function(e){n.siteInfo=e})}angular.module("app").controller("SignupController",e),e.$inject=["$scope","$http","$window","$location","$state","$stateParams","API","ENUM","AppAuthenticationService","$interval"]}();
!function(){"use strict";function t(t,e){t.state("signup",{needAuth:!1,url:"/signup",title:"用户注册",templateUrl:"modules/signup/signup.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(t,e,n,o,a,c,r,l,p,d,i){d.order?(t.selectedType=null,t.paymentModel=d,t.isSelected=function(e){if(!t.selectedType)return!1;if(e.channel==t.selectedType.channel)return!0;return!1},t.touchSelect=function(e){t.selectedType=e},t.touchSubmit=function(){if(!t.selectedType)return void t.toast("请选择支持方式");switch(t.selectedType.channel){case"chinapay":var e=encodeURIComponent(i.location.protocol+"//"+i.location.host+i.location.pathname),n={order:t.paymentModel.order.id,code:"teegon.wap",channel:"chinapay",referer:e};l.payment.pay(n).then(function(e){return e.data.teegon&&e.data.teegon.url&&(i.location.href=e.data.teegon.url),!0});break;case"wxpay":var e=encodeURIComponent(i.location.protocol+"//"+i.location.host+i.location.pathname),n={order:t.paymentModel.order.id,code:"teegon.wap",channel:"wxpay_jsapi",referer:e};l.payment.pay(n).then(function(e){return e.data.teegon&&e.data.teegon.url&&(i.location.href=e.data.teegon.url),!0})}},t.teegonTypes=[],t.teegonTypes.push({name:"天工收银银联支付",desc:"天工收银银联支付",channel:"chinapay"}),t.teegonTypes.push({name:"微信支付",desc:"天工收银微信支付",channel:"wxpay"}),t.paymentModel.reload().then(function(e){})):c(function(){a.goHome()},1)}angular.module("app").controller("TeegonController",e),e.$inject=["$scope","$http","$location","$state","$rootScope","$timeout","$stateParams","API","ENUM","PaymentModel","$window"]}();
!function(){"use strict";function e(e,t){e.state("teegon",{needAuth:!1,url:"/teegon",title:"收银台",templateUrl:"modules/teegon/teegon.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(e,o,t,n,r,c){var i=encodeURIComponent(t.location.protocol+"//"+t.location.host+t.location.pathname),a="snsapi_userinfo";if(c.getReferences())var p=parseInt(c.getReferences()),l=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope="+a+"&invite_code="+p+"&referer="+i;else l=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope="+a+"&referer="+i;t.location.href=l}angular.module("app").controller("WeChatAuthController",e),e.$inject=["$scope","$http","$window","$location","$timeout","AppAuthenticationService"]}();
!function(){"use strict";function t(t,e){t.state("wechat-auth",{needAuth:!1,url:"/wechat-auth",title:"微信登录",controller:"WeChatAuthController",templateUrl:"modules/wechat-auth/wechat-auth.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(o,t,e,n,a){var c=encodeURIComponent(e.location.protocol+"//"+e.location.host+e.location.pathname),i=GLOBAL_CONFIG.API_HOST+"/v2/ecapi.auth.web?vendor=1&scope=snsapi_userinfo&referer="+c;e.location.href=i}angular.module("app").controller("WeChatAuthBaseController",o),o.$inject=["$scope","$http","$window","$location","$timeout"]}();
!function(){"use strict";function t(t,e){t.state("wechat-authbase",{needAuth:!1,url:"/wechat-authbase",title:"微信登录",controller:"WeChatAuthBaseController",templateUrl:"modules/wechat-authbase/wechat-authbase.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function e(e,o,n,t,a,r,i,s,c,p,d){var f=i.order;if(f){n.$on("onPaySuccess",function(e,o){a.go("payment-success",{order:f})}),n.$on("onPayFailed",function(e,o){a.go("payment-failed",{order:f,reason:"微信支付失败"})});var u=d.getConfig()["wxpay.web"];u?(wx.config({debug:GLOBAL_CONFIG.DEBUG,appId:u.app_id,timestamp:u.timestamp,nonceStr:u.nonceStr,signature:u.signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){s.pay(f).then(function(e){})}),wx.error(function(e){GLOBAL_CONFIG.DEBUG&&n.toast(JSON.stringify(e))})):a.go("payment-failed",{order:f,reason:"配置错误"})}else a.go("payment-failed",{order:f,reason:"参数错误"})}angular.module("app").controller("WeChatPayController",e),e.$inject=["$scope","$http","$rootScope","$window","$state","$location","$stateParams","WeixinService","API","ENUM","ConfigModel"]}();
!function(){"use strict";function t(t,e){t.state("wechat-pay",{needAuth:!0,url:"/wechat-pay?order",title:"微信支付",controller:"WeChatPayController",templateUrl:"modules/wechat-pay/wechat-pay.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function i(o,i,t,l,n,a,c,r,e,w){o.cancellingWithDraw=null,o.showDialog=!1,o.withDrawHistoryModel=w,o.touchDialogCancel=function(){o.cancellingWithDraw=null,o.showDialog=!1},o.touchDialogConfirm=function(){r.withdraw.cancel({id:o.cancellingWithDraw.id}).then(function(i){o.withDrawHistoryModel.reload(),o.cancellingWithDraw=null,o.showDialog=!1})},o.touchCancel=function(i){o.cancellingWithDraw=i,o.showDialog=!0},o.withDrawHistoryModel.reload()}angular.module("app").controller("WithDrawHistoryController",i),i.$inject=["$scope","$http","$window","$timeout","$location","$state","$stateParams","API","ENUM","WithDrawHistoryModel"]}();
!function(){"use strict";function t(t,r){t.state("withdraw-history",{needAuth:!0,url:"/withdraw-history",title:"提现记录",templateUrl:"modules/withdraw-history/withdraw-history.html"})}angular.module("app").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function t(t,i,s,a,e,h,n,r){var o={isEmpty:!1,isLoaded:!1,isLoading:!1,isLastPage:!1,status:null,withdraws:[],fetch:function(t,i){if(!h.getToken())return;this.isLoading=!0;var s={page:t,per_page:i};null!=this.status&&(s.status=this.status);var a=this;n.withdraw.list(s).then(function(t){a.withdraws=a.withdraws?a.withdraws.concat(t):t,a.isEmpty=!a.withdraws||!a.withdraws.length,a.isLoaded=!0,a.isLoading=!1,a.isLastPage=!!(t&&t.length<i)&&!a.isEmpty})},reload:function(){if(!h.getToken())return;if(this.isLoading)return;this.withdraws=null,this.isEmpty=!1,this.isLoaded=!1,this.isLastPage=!1,this.fetch(1,10)},loadMore:function(){if(!h.getToken())return;if(this.isLoading)return;if(this.isLastPage)return;this.withdraws&&this.withdraws.length?this.fetch(this.withdraws.length/10+1,10):this.fetch(1,10)}};return o}angular.module("app").factory("WithDrawHistoryModel",t),t.$inject=["$http","$q","$timeout","$rootScope","CacheFactory","AppAuthenticationService","API","ENUM"]}();
!function(){"use strict";function t(t,e,o,r,a){t.withdraw=a.withdraw,t.member_memo=a.member_memo}angular.module("app").controller("WithDrawSuccessController",t),t.$inject=["$scope","$http","$location","$state","$stateParams"]}();
!function(){"use strict";function e(e,t){e.state("withdraw-success",{needAuth:!0,url:"/withdraw-success?withdraw&member_memo",title:"提现成功",templateUrl:"modules/withdraw-success/withdraw-success.html"})}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}();